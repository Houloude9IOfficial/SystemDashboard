<script>
// CONFIG | CUSTOMIZE EVERYTHING IN HERE:

const port = 2453; // Default private port

const wwsport = 2454; // Default private websocket port

    let dashboardname = 'System Dashboard'
    let default_theme = 'light'
    let allowwatermark = true
    //let port = 9998
    //let wwsport = 9999
    let show_welcome_message = true
    let baseurl = `http://localhost:${port}`
    let basews = `ws://localhost:${wwsport}`
</script>
<!DOCTYPE html>
<html lang="en">
<head>
    <script>
    function updateTheme(isDark, updatecharts = true) {
        document.documentElement.setAttribute('data-theme', isDark ? 'darktheme' : 'lighttheme');
        localStorage.setItem('darkMode', isDark ? 'dark' : 'light');
        if(updatecharts == true) {
        updateChartColors();
        }
    }
    const savedDarkMode = localStorage.getItem('darkMode');
    if (savedDarkMode) {
        const isDark = savedDarkMode === 'dark';
        //darkModeToggle.checked = isDark;
        updateTheme(isDark, false);
    } else {
        const isDark = default_theme === 'dark';
        //darkModeToggle.checked = isDark;
        updateTheme(isDark, false);
    }
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Monitoring Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <link rel="icon" type="image/svg" href="favicon.svg">
    <style>
:root {
    --primary-color: #3498db;
    --card-bg: #ffffff;
    --background: #f0f2f5;
    --text-color: #2c3e50;
    --secondary-color: #7f8c8d;
    --opposite-text-color: #e0e0e0;
    --full-color: #000000;
    --transition: all 0.3s ease;
    --transition-time: 0.25s;
}

[data-scheme="dark-blue"] { --primary-color: #2980b9; --secondary-color: #2c3e50; }
[data-scheme="orange"] { --primary-color: #e67e22; --secondary-color: #d35400; }
[data-scheme="purple"] { --primary-color: #9b59b6; --secondary-color: #8e44ad; }
[data-scheme="pink"] { --primary-color: #e91e63; --secondary-color: #c2185b; }
[data-scheme="green"] { --primary-color: #2ecc71; --secondary-color: #27ae60; }

[data-theme="darktheme"] {
  --card-bg: #1e1e1e;
  --background: #121212;
  --text-color: #e0e0e0;
  --secondary-color: #3a5068;
  --opposite-text-color: #2c3e50;
  --full-color: #ffffff;
}

[data-theme="lighttheme"] {
  --card-bg: #ffffff;
  --background: #f0f2f5;
  --text-color: #2c3e50;
  --secondary-color: #7f8c8d;
  --opposite-text-color: #e0e0e0;
  --full-color: #000000;
}


* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    font-family: 'Inter', sans-serif;
}

body {
    background-color: var(--background);
    color: var(--text-color);
    line-height: 1.6;
    transition: var(--transition);
    min-height: 100vh;
}

body {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  margin: 0;
}

  .container {
    max-width: 1400px;
    padding: 20px;
    transition: 
      width  var(--transition-time)  ease,
      margin  var(--transition-time)  ease,
      justify-content  var(--transition-time)  ease,
      align-items  var(--transition-time)  ease;
  }

  .version1 {
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 0;
  }

  .version2 {
    width: 95%;
    margin: 0 auto;
    display: block;
  }


.login-container {
  background: var(--card-bg);
  border-radius: 16px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
  width: 90%;
  max-width: 440px;
  padding: 30px;
  opacity: 0;
  animation: slideUp 0.6s forwards;
}

@keyframes slideUp {
    to { transform: translateY(0); opacity: 1; }
}

.dashboard-container {
    display: none;
    opacity: 0;
    transform: translateY(20px);
    animation: fadeIn 0.6s forwards;
}

@keyframes fadeIn {
    to { opacity: 1; transform: translateY(0); }
}

.header {
    display: flex;
    flex-direction: column;
    gap: 15px;
    margin-bottom: 20px;
    margin-top: 180px;
    padding: 15px;
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    border-radius: 16px;
    color: white;
    box-shadow: 0 4px 24px rgba(0, 0, 0, 0.1);
}

.header2 {
    display: flex;
    flex-direction: column;
    gap: 15px;
    margin-bottom: 20px;
    padding: 15px;
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    border-radius: 16px;
    color: white;
    box-shadow: 0 4px 24px rgba(0, 0, 0, 0.1);
    align-items: center;
}

.header h1, .header h2, .header2 h1, .header2 h2 {
    font-size: clamp(1.5rem, 4vw, 2rem);
    text-align: center;
    transition: opacity 0.5s ease;
    opacity: 1;
}

.dashboard-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
    margin-bottom: 20px;
}

.dashboard-card {
    background: var(--card-bg);
    border-radius: 16px;
    padding: 20px;
    transition: var(--transition);
    box-shadow: 0 4px 24px rgba(0, 0, 0, 0.05);
    position: relative;
    overflow: hidden;
    min-height: 300px;
}

.chart-container {
    height: 200px;
    margin-top: 15px;
    position: relative;
}

button {
    background: var(--primary-color);
    color: white;
    border: none;
    border-radius: 8px;
    padding: 10px 15px;
    font-size: 14px;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    gap: 6px;
    white-space: nowrap;
}

.controls {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

.theme-selector, .darktheme-selector {
    display: flex;
    gap: 6px;
    align-items: center;
}

.theme-option {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    cursor: pointer;
    border: 2px solid transparent;
    transition: var(--transition);
}

.theme-option.active { border-color: white; }

.metric-value {
    font-size: clamp(1.5rem, 5vw, 2rem);
    font-weight: 700;
    margin: 8px 0;
}

.network-stats {
    display: flex;
    justify-content: space-around;
    margin: 12px 0;
    flex-wrap: wrap;
    gap: 10px;
}

.network-stats > div {
    text-align: center;
    min-width: 100px;
}

.form-group {
    margin-bottom: 15px;
}

[data-theme="darktheme"] {
  --card-bg: #1e1e1e;
  --background: #121212;
  --text-color: #e0e0e0;
  --secondary-color: #3a5068;
  --opposite-text-color: #e0e0e0;
  --full-color: #ffffff;
}

[data-theme="lighttheme"] {
  --card-bg: #ffffff;
  --background: #f0f2f5;
  --text-color: #2c3e50;
  --secondary-color: #7f8c8d;
  --opposite-text-color: #e0e0e0;
  --full-color: #000000;
}

input[type="text"], 
input[type="password"] {
    color: var(--opposite-text-color);
    background: var(--secondary-color);
    width: 100%;
    padding: 10px;
    border: 2px solid color-mix(in srgb, var(--secondary-color) 70%, rgb(0, 0, 0) 30%);
    border-radius: 8px;
    font-size: 16px;
    transition: var(--transition);
}

input[type="text"]:focus, 
input[type="password"]:focus {
    border-color: var(--primary-color);
    outline: none;
    box-shadow: 0 0 0 1px rgba(52, 152, 219, 0.2);
}

input[type="text"]:disabled, 
input[type="password"]:disabled {
    background: var(--secondary-color);
    color: var(--opposite-text-color);
    opacity: 0.6;
    cursor: not-allowed;
    border-color: var(--secondary-color);
    transition: var(--transition);
}

button[type="submit"] {
    width: 100%;
    padding: 12px;
    background: var(--primary-color);
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
    transition: var(--transition);
}

button[type="submit"]:hover {
    filter: brightness(0.9);
}

.remember-me {
    display: flex;
    align-items: center; /* Vertically centers the elements */
    justify-content: center; /* Horizontally centers the elements */
    gap: 8px;
    margin: 12px 0;
}

.remember-me input {
    width: auto; /* Keeps the checkbox size as is */
}


.realtime-controls {
    display: flex;
    align-items: center;
    gap: 6px;
}

.interval-input {
    display: none;
    width: 50px;
    padding: 6px;
    border: 2px solid var(--card-bg);
    border-radius: 8px;
    background: var(--card-bg);
    color: var(--text-color);
    transition: var(--transition);
    max-width: 50px;
    width: 25px;
}

.interval-input:focus {
    border-color: var(--primary-color);
    outline: none;
    box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
}

#realtime-toggle.active {
    background: var(--secondary-color);
}

/* Theme Toggle Switch */
.theme-toggle {
    display: flex;
    align-items: center;
}

.switch {
    position: relative;
    display: inline-block;
    width: 50px;
    height: 24px;
}

.switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: .4s;
    border-radius: 34px;
}

.slider:before {
    position: absolute;
    content: "";
    height: 16px;
    width: 16px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    transition: .4s;
    border-radius: 50%;
}

input:checked + .slider {
    background-color: var(--primary-color);
}

input:checked + .slider:before {
    transform: translateX(26px);
}

.labels {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 100%;
    font-size: 10px;
    font-weight: bold;
    text-align: center;
    transition: opacity var(--transition-time) ease-in-out;
    color: white;
}

.labels::before {
    content: attr(data-off);
    position: absolute;
    left: 8px;
    opacity: 1;
    transition: opacity 0.3s;
}

.labels::after {
    content: attr(data-on);
    position: absolute;
    right: 8px;
    opacity: 0;
    transition: opacity 0.3s;
}

input:checked + .slider + .labels::before {
    opacity: 0;
}

input:checked + .slider + .labels::after {
    opacity: 1;
}

.color-scheme-selector {
    display: flex;
    gap: 6px;
    align-items: center;
    flex-wrap: wrap;
    justify-content: center;
}

/* For WebKit browsers (Chrome, Safari, Edge) */
.interval-input::-webkit-inner-spin-button,
.interval-input::-webkit-outer-spin-button {
    -webkit-appearance: none;
    margin: 0;
}

/* For Firefox */
.interval-input {
    -moz-appearance: textfield;
}

/* From Uiverse.io by cuzpq */ 
.theme-checkbox {
  --toggle-size: 14px;
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  width: 5em;
  border: 3px solid color-mix(in srgb, var(--primary-color) 50%, rgb(0, 0, 0) 50%);
  height: 2.5em;
  background: -webkit-gradient(linear, left top, right top, color-stop(50%, #efefef), color-stop(50%, #2a2a2a)) no-repeat;
  background: -o-linear-gradient(left, #efefef 50%, #2a2a2a 50%) no-repeat;
  background: linear-gradient(to right, #efefef 50%, #2a2a2a 50%) no-repeat;
  background-size: 205%;
  background-position: 0;
  -webkit-transition: 0.4s;
  -o-transition: 0.4s;
  transition: 0.4s;
  border-radius: 99em;
  position: relative;
  cursor: pointer;
  font-size: var(--toggle-size);
}

.theme-checkbox::before {
  content: "";
  width: 1.8em;
  height: 1.8em;
  position: absolute;
  top: 0.35em;
  left: 0.35em;
  background: -webkit-gradient(linear, left top, right top, color-stop(50%, #efefef), color-stop(50%, #2a2a2a)) no-repeat;
  background: -o-linear-gradient(left, #efefef 50%, #2a2a2a 50%) no-repeat;
  background: linear-gradient(to right, #efefef 50%, #2a2a2a 50%) no-repeat;
  background-size: 205%;
  background-position: 100%;
  border-radius: 50%;
  -webkit-transition: 0.4s;
  -o-transition: 0.4s;
  transition: 0.4s;
}

.theme-checkbox:checked::before {
  left: calc(100% - 1.8em - 0.35em);
  background-position: 0;
}

.theme-checkbox:checked {
  background-position: 100%;
}

/* Responsive adjustments */
@media (min-width: 768px) {
    .header {
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
    }
    
    .controls {
        flex-wrap: nowrap;
        gap: 15px;
    }
    
    .theme-option {
        width: 24px;
        height: 24px;
    }
    
    .switch {
        width: 60px;
        height: 30px;
    }
    
    .slider:before {
        height: 22px;
        width: 22px;
    }
    
    input:checked + .slider:before {
        transform: translateX(30px);
    }
    
    .theme-checkbox {
        --toggle-size: 16px;
    }
    
    button {
        padding: 12px 20px;
    }
}

@media (max-width: 480px) {
    .login-container {
        padding: 20px;
    }
    
    .dashboard-card {
        min-height: 250px;
    }
    
    .chart-container {
        height: 150px;
    }
    
    .network-stats > div {
        min-width: 80px;
    }
    
    .controls {
        gap: 8px;
    }
    
    button {
        padding: 8px 12px;
        font-size: 12px;
    }
    
    .interval-input {
        width: 40px;
    }
}

.checkbox-wrapper input[type="checkbox"] {
  display: none;
}

.checkbox-wrapper .terms-label {
  border-radius: 25px;
  cursor: pointer;
  display: flex;
  align-items: center;
  user-select: none;
  -webkit-user-select: none;
  -webkit-user-drag: none;
  margin-bottom: 25px;
}

.checkbox-wrapper .terms-label .label-text {
  margin-left: 10px;
}

.checkbox-wrapper .checkbox-svg {
  border-radius: 5px;
  border: 5;
  border: var(--secondary-color);
  width: 30px;
  height: 30px;
}

.checkbox-wrapper .checkbox-box {
  /* fill: rgba(0, 0, 0, 0.393); */
  fill: var(--secondary-color);
  stroke: var(--primary-color);
  background: solid color-mix(in srgb, var(--primary-color) 50%, rgb(0, 0, 0) 50%);;
  stroke-dasharray: 800;
  stroke-dashoffset: 800;
  transition: stroke-dashoffset var(--transition-time) ease-in-out;
  margin-top: 50px;
  margin-bottom: 50px;
  gap: 50px;
  padding-bottom: 500px;
}

.checkbox-wrapper .checkbox-tick {
  stroke: var(--primary-color);
  stroke-dasharray: 172;
  stroke-dashoffset: 172;
  transition: stroke-dashoffset var(--transition-time) ease-in-out;
}

.checkbox-wrapper input[type="checkbox"]:checked + .terms-label .checkbox-box,
  .checkbox-wrapper input[type="checkbox"]:checked + .terms-label .checkbox-tick {
  stroke-dashoffset: 0;
}

.wait-screen {
    width: 100%;
    height: 100%;
    position: fixed;
    top: 0;
    left: 0;
    background-color: var(--background);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    opacity: 1;
    visibility: visible;
    transition: opacity 0.5s ease, visibility 0.5s ease;
}

.wait-screen.hidden {
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
}


.wait-screen.fade-out {
    opacity: 0;
    transition: opacity 0.5s ease-out;
    pointer-events: none;
}

/* From Uiverse.io by Nawsome */ 
.banter-loader {
  position: absolute;
  left: 50%;
  top: 50%;
  width: 72px;
  height: 72px;
  margin-left: -36px;
  margin-top: -36px;
}

.banter-loader__box {
  float: left;
  position: relative;
  width: 20px;
  height: 20px;
  margin-right: 6px;
}

.banter-loader__box:before {
  content: "";
  position: absolute;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background: var(--full-color);
}

.banter-loader__box:nth-child(3n) {
  margin-right: 0;
  margin-bottom: 6px;
}

.banter-loader__box:nth-child(1):before, .banter-loader__box:nth-child(4):before {
  margin-left: 26px;
}

.banter-loader__box:nth-child(3):before {
  margin-top: 52px;
}

.banter-loader__box:last-child {
  margin-bottom: 0;
}

@keyframes moveBox-1 {
  9.0909090909% {
    transform: translate(-26px, 0);
  }

  18.1818181818% {
    transform: translate(0px, 0);
  }

  27.2727272727% {
    transform: translate(0px, 0);
  }

  36.3636363636% {
    transform: translate(26px, 0);
  }

  45.4545454545% {
    transform: translate(26px, 26px);
  }

  54.5454545455% {
    transform: translate(26px, 26px);
  }

  63.6363636364% {
    transform: translate(26px, 26px);
  }

  72.7272727273% {
    transform: translate(26px, 0px);
  }

  81.8181818182% {
    transform: translate(0px, 0px);
  }

  90.9090909091% {
    transform: translate(-26px, 0px);
  }

  100% {
    transform: translate(0px, 0px);
  }
}

.banter-loader__box:nth-child(1) {
  animation: moveBox-1 4s infinite;
}

@keyframes moveBox-2 {
  9.0909090909% {
    transform: translate(0, 0);
  }

  18.1818181818% {
    transform: translate(26px, 0);
  }

  27.2727272727% {
    transform: translate(0px, 0);
  }

  36.3636363636% {
    transform: translate(26px, 0);
  }

  45.4545454545% {
    transform: translate(26px, 26px);
  }

  54.5454545455% {
    transform: translate(26px, 26px);
  }

  63.6363636364% {
    transform: translate(26px, 26px);
  }

  72.7272727273% {
    transform: translate(26px, 26px);
  }

  81.8181818182% {
    transform: translate(0px, 26px);
  }

  90.9090909091% {
    transform: translate(0px, 26px);
  }

  100% {
    transform: translate(0px, 0px);
  }
}

.banter-loader__box:nth-child(2) {
  animation: moveBox-2 4s infinite;
}

@keyframes moveBox-3 {
  9.0909090909% {
    transform: translate(-26px, 0);
  }

  18.1818181818% {
    transform: translate(-26px, 0);
  }

  27.2727272727% {
    transform: translate(0px, 0);
  }

  36.3636363636% {
    transform: translate(-26px, 0);
  }

  45.4545454545% {
    transform: translate(-26px, 0);
  }

  54.5454545455% {
    transform: translate(-26px, 0);
  }

  63.6363636364% {
    transform: translate(-26px, 0);
  }

  72.7272727273% {
    transform: translate(-26px, 0);
  }

  81.8181818182% {
    transform: translate(-26px, -26px);
  }

  90.9090909091% {
    transform: translate(0px, -26px);
  }

  100% {
    transform: translate(0px, 0px);
  }
}

.banter-loader__box:nth-child(3) {
  animation: moveBox-3 4s infinite;
}

@keyframes moveBox-4 {
  9.0909090909% {
    transform: translate(-26px, 0);
  }

  18.1818181818% {
    transform: translate(-26px, 0);
  }

  27.2727272727% {
    transform: translate(-26px, -26px);
  }

  36.3636363636% {
    transform: translate(0px, -26px);
  }

  45.4545454545% {
    transform: translate(0px, 0px);
  }

  54.5454545455% {
    transform: translate(0px, -26px);
  }

  63.6363636364% {
    transform: translate(0px, -26px);
  }

  72.7272727273% {
    transform: translate(0px, -26px);
  }

  81.8181818182% {
    transform: translate(-26px, -26px);
  }

  90.9090909091% {
    transform: translate(-26px, 0px);
  }

  100% {
    transform: translate(0px, 0px);
  }
}

.banter-loader__box:nth-child(4) {
  animation: moveBox-4 4s infinite;
}

@keyframes moveBox-5 {
  9.0909090909% {
    transform: translate(0, 0);
  }

  18.1818181818% {
    transform: translate(0, 0);
  }

  27.2727272727% {
    transform: translate(0, 0);
  }

  36.3636363636% {
    transform: translate(26px, 0);
  }

  45.4545454545% {
    transform: translate(26px, 0);
  }

  54.5454545455% {
    transform: translate(26px, 0);
  }

  63.6363636364% {
    transform: translate(26px, 0);
  }

  72.7272727273% {
    transform: translate(26px, 0);
  }

  81.8181818182% {
    transform: translate(26px, -26px);
  }

  90.9090909091% {
    transform: translate(0px, -26px);
  }

  100% {
    transform: translate(0px, 0px);
  }
}

.banter-loader__box:nth-child(5) {
  animation: moveBox-5 4s infinite;
}

@keyframes moveBox-6 {
  9.0909090909% {
    transform: translate(0, 0);
  }

  18.1818181818% {
    transform: translate(-26px, 0);
  }

  27.2727272727% {
    transform: translate(-26px, 0);
  }

  36.3636363636% {
    transform: translate(0px, 0);
  }

  45.4545454545% {
    transform: translate(0px, 0);
  }

  54.5454545455% {
    transform: translate(0px, 0);
  }

  63.6363636364% {
    transform: translate(0px, 0);
  }

  72.7272727273% {
    transform: translate(0px, 26px);
  }

  81.8181818182% {
    transform: translate(-26px, 26px);
  }

  90.9090909091% {
    transform: translate(-26px, 0px);
  }

  100% {
    transform: translate(0px, 0px);
  }
}

.banter-loader__box:nth-child(6) {
  animation: moveBox-6 4s infinite;
}

@keyframes moveBox-7 {
  9.0909090909% {
    transform: translate(26px, 0);
  }

  18.1818181818% {
    transform: translate(26px, 0);
  }

  27.2727272727% {
    transform: translate(26px, 0);
  }

  36.3636363636% {
    transform: translate(0px, 0);
  }

  45.4545454545% {
    transform: translate(0px, -26px);
  }

  54.5454545455% {
    transform: translate(26px, -26px);
  }

  63.6363636364% {
    transform: translate(0px, -26px);
  }

  72.7272727273% {
    transform: translate(0px, -26px);
  }

  81.8181818182% {
    transform: translate(0px, 0px);
  }

  90.9090909091% {
    transform: translate(26px, 0px);
  }

  100% {
    transform: translate(0px, 0px);
  }
}

.banter-loader__box:nth-child(7) {
  animation: moveBox-7 4s infinite;
}

@keyframes moveBox-8 {
  9.0909090909% {
    transform: translate(0, 0);
  }

  18.1818181818% {
    transform: translate(-26px, 0);
  }

  27.2727272727% {
    transform: translate(-26px, -26px);
  }

  36.3636363636% {
    transform: translate(0px, -26px);
  }

  45.4545454545% {
    transform: translate(0px, -26px);
  }

  54.5454545455% {
    transform: translate(0px, -26px);
  }

  63.6363636364% {
    transform: translate(0px, -26px);
  }

  72.7272727273% {
    transform: translate(0px, -26px);
  }

  81.8181818182% {
    transform: translate(26px, -26px);
  }

  90.9090909091% {
    transform: translate(26px, 0px);
  }

  100% {
    transform: translate(0px, 0px);
  }
}

.banter-loader__box:nth-child(8) {
  animation: moveBox-8 4s infinite;
}

@keyframes moveBox-9 {
  9.0909090909% {
    transform: translate(-26px, 0);
  }

  18.1818181818% {
    transform: translate(-26px, 0);
  }

  27.2727272727% {
    transform: translate(0px, 0);
  }

  36.3636363636% {
    transform: translate(-26px, 0);
  }

  45.4545454545% {
    transform: translate(0px, 0);
  }

  54.5454545455% {
    transform: translate(0px, 0);
  }

  63.6363636364% {
    transform: translate(-26px, 0);
  }

  72.7272727273% {
    transform: translate(-26px, 0);
  }

  81.8181818182% {
    transform: translate(-52px, 0);
  }

  90.9090909091% {
    transform: translate(-26px, 0);
  }

  100% {
    transform: translate(0px, 0);
  }
}

.banter-loader__box:nth-child(9) {
  animation: moveBox-9 4s infinite;
}

#systemname {
  color: var(--text-color);
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 24px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 100%;
  flex-wrap: nowrap;
}

#welcomeback {
    margin-bottom: 200px;
}
    </style>
</head>
<body>
<div class="wait-screen">
<h1 id="welcomeback">Welcome back.</h1>
<div class="banter-loader">
  <div class="banter-loader__box"></div>
  <div class="banter-loader__box"></div>
  <div class="banter-loader__box"></div>
  <div class="banter-loader__box"></div>
  <div class="banter-loader__box"></div>
  <div class="banter-loader__box"></div>
  <div class="banter-loader__box"></div>
  <div class="banter-loader__box"></div>
  <div class="banter-loader__box"></div>
</div>
</div>
    <div class="container version1">
        <div id="login-container" class="login-container">
            <h2 id="systemname"><i class="fas fa-chart-line"></i> System Dashboard</h2>
            <p style="margin: 20px 0 30px; color: #7f8c8d;">Enter your credentials to continue</p>
            
            <form id="login-form">
                <div class="form-group">
                    <input type="text" id="username" placeholder="Username" required>
                </div>
                <div class="form-group">
                    <input type="password" id="password" placeholder="Password" required>
                </div>
<div class="checkbox-wrapper">
    <input id="terms-checkbox-37" name="checkbox" type="checkbox">
    <label class="terms-label" for="terms-checkbox-37">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 200 200" class="checkbox-svg">
        <mask fill="white" id="path-1-inside-1_476_5-37">
          <rect height="200" width="200"></rect>
        </mask>
        <rect mask="url(#path-1-inside-1_476_5-37)" stroke-width="40" class="checkbox-box" height="200" width="200"></rect>
        <path stroke-width="15" d="M52 111.018L76.9867 136L149 64" class="checkbox-tick"></path>
      </svg>
      <span class="label-text">Remember Me</span>
    </label>
  </div>
  
  
  
                <button type="submit"><i class="fas fa-sign-in-alt"></i> Login</button>
                <p id="watermark" style=" text-align: center; margin: 20px 0 30px; color: #7f8c8d; cursor: pointer;" onclick="window.open('https://github.com/Houloude9IOfficial', '_blank')">Developed by Houloude9</p>
                <div id="error-message" style="color: #e74c3c; margin-top: 15px; display: none;"></div>
            </form>
        </div>

        <div id="dashboard-container" class="dashboard-container">
            <div class="header">
                <h1 id="systemname"><i class="fas fa-chart-line"></i> System Dashboard</h1>
                <div class="controls">
                    <div class="theme-toggle">
                        <label class="switch">
                            <input type="checkbox" id="dark-mode-toggle" class="theme-checkbox">
                            <span class="slider round"></span>
                        </label>
                    </div>
                    
                    <!-- Color Scheme Selector -->
                    <div class="color-scheme-selector">
                        <div class="theme-option" data-scheme="dark-blue" style="background: #2980b9"></div>
                        <div class="theme-option" data-scheme="orange" style="background: #e67e22"></div>
                        <div class="theme-option" data-scheme="purple" style="background: #9b59b6"></div>
                        <div class="theme-option" data-scheme="pink" style="background: #e91e63"></div>
                        <div class="theme-option" data-scheme="green" style="background: #2ecc71"></div>
                    </div>
                    <div class="realtime-controls">
                        <button id="realtime-toggle"><i class="fas fa-play"></i> Realtime</button>
                        <input type="number" id="refresh-interval" class="interval-input" value="1" min="1" max="60">
                        <span></span>
                    </div>
                    <button id="refresh-btn" class="logout-btn"><i class="fa-solid fa-arrows-rotate"></i> Refresh</button>
                    <button id="logout-btn" class="logout-btn"><i class="fas fa-sign-out-alt"></i> Logout</button>
                </div>
            </div>
            <div class="header2">
                <h2 id="systemstatus" style="margin: 0;">Measuring System Status</h2>
            </div>

            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <i class="fas fa-hard-drive"></i>
                    <h3>Storage</h3>
                    <div class="chart-container">
                        <canvas id="db-chart"></canvas>
                    </div>
                </div>

                <div class="dashboard-card">
                    <i class="fas fa-microchip"></i>
                    <h3>CPU Usage</h3>
                    <div class="metric-value" id="cpu-usage">0%</div>
                    <div class="chart-container">
                        <canvas id="cpu-chart"></canvas>
                    </div>
                </div>

                <div class="dashboard-card">
                    <i class="fas fa-memory"></i>
                    <h3>RAM Usage</h3>
                    <div class="metric-value" id="ram-usage">0%</div>
                    <div class="chart-container">
                        <canvas id="ram-chart"></canvas>
                    </div>
                </div>

                <div class="dashboard-card">
                    <i class="fas fa-tachometer-alt"></i>
                    <h3>Network Traffic</h3>
                    <div class="network-stats">
                        <div>
                            <div class="metric-value" id="network-received">0</div>
                            <small>Received (KB)</small>
                        </div>
                        <div>
                            <div class="metric-value" id="network-sent">0</div>
                            <small>Sent (KB)</small>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="network-chart"></canvas>
                    </div>
                </div>

                <div class="dashboard-card" id="gpu-card" style="display: none;">
                    <i class="fas fa-tv"></i>
                    <h3>GPU Usage</h3>
                    <div class="metric-value" id="gpu-usage">0%</div>
                    <div>Memory: <span id="gpu-mem-used">0</span> / <span id="gpu-mem-total">0</span> GB</div>
                    <div class="chart-container">
                        <canvas id="gpu-chart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const loginForm = document.getElementById('login-form');
        const loginContainer = document.getElementById('login-container');
        const dashboardContainer = document.getElementById('dashboard-container');
        const errorMessage = document.getElementById('error-message');
        let charts = {};
        let currentServerData;
        let chartsinited = false;

function waitscreen(show = true) {
    const waitScreen = document.querySelector('.wait-screen');

    if (show) {
        waitScreen.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
    } else {
        waitScreen.classList.add('hidden');
        document.body.style.overflow = 'auto';
    }
}

function updateStatusText(newText) {
    const statusEl = document.getElementById('systemstatus');
    if(statusEl.textContent === newText) {return;}
    
    statusEl.style.opacity = 0;
    
    setTimeout(() => {
        statusEl.textContent = newText;
        statusEl.style.opacity = 1;
    }, 500);
}


function getuserdata() {
    let username = sessionStorage.getItem('username') ?? localStorage.getItem('username') ?? null;
    let password = sessionStorage.getItem('password') ?? localStorage.getItem('password') ?? null;
    let rememberme = localStorage.getItem('username');
    return { username, password, rememberme };
}

    if(show_welcome_message === false) {
        document.getElementById('welcomeback').style.display = 'none';
    }

  const container = document.querySelector('.container');


  function toggleContainerStyle() {
    if (container.classList.contains('version1')) {
      container.classList.remove('version1');
      container.classList.add('version2');
    } else {
      container.classList.remove('version2');
      container.classList.add('version1');
    }
  }

        function formatStorage(valueMB) {
            if (valueMB >= 1000) {
                return (valueMB / 1000).toFixed(1) + ' TB';
            }
            return valueMB.toFixed(1) + ' GB';
        }

        function formatNetworkValue(bytes) {
    const kb = bytes / 1024;
    if (kb < 0.0001) {
        return kb.toExponential(2) + 'KB';
    } else {
        return kb.toFixed(4) + 'KB';
    }
}

        function initializeCharts(serverData) {
            chartsinited = true;
            if (charts.dbChart) charts.dbChart.destroy();
            if (charts.cpuChart) charts.cpuChart.destroy();
            if (charts.ramChart) charts.ramChart.destroy();
            if (charts.networkChart) charts.networkChart.destroy();

            charts.dbChart = new Chart(document.getElementById('db-chart'), {
                type: 'pie',
                data: {
                    labels: ['Used', 'Free'],
                    datasets: [{
                        data: [serverData.DB_used, serverData.DB_all - serverData.DB_used],
                        backgroundColor: [
                            getComputedStyle(document.body).getPropertyValue('--primary-color'),
                            '#ecf0f1'
                        ]
                    }]
                },
                options: {
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: ctx => {
                                    const total = serverData.DB_all;
                                    const value = ctx.raw;
                                    return `${ctx.label}: ${formatStorage(value)} (${((value/total)*100).toFixed(1)}%)`;
                                }
                            }
                        }
                    }
                }
            });

            // CPU Usage
            charts.cpuChart = createColumnChart('cpu-chart', serverData.SysUsage * 100, 'CPU Usage');
            document.getElementById('cpu-usage').textContent = `${(serverData.SysUsage * 100).toFixed(1)}%`;

            // RAM Usage
            charts.ramChart = createColumnChart('ram-chart', serverData.RamUsage, 'RAM Usage');
            document.getElementById('ram-usage').textContent = `${serverData.RamUsage.toFixed(1)}%`;

            // Network Traffic
            const netData = serverData.NetworkUsage;
            charts.networkChart = new Chart(document.getElementById('network-chart'), {
                type: 'bar',
                data: {
                    labels: ['Received', 'Sent'],
                    datasets: [{
                        label: 'KB',
                        data: [netData.totalReceived/1024, netData.totalSent/1024],
                        backgroundColor: [
                            getComputedStyle(document.body).getPropertyValue('--primary-color'),
                            getComputedStyle(document.body).getPropertyValue('--secondary-color')
                        ]
                    }]
                },
                options: { responsive: true, scales: { y: { beginAtZero: true } } }
            });
            
            

            document.getElementById('network-received').textContent = netData.totalReceived < 0.01 ? '0' : parseFloat(netData.totalReceived.toFixed(2));
            document.getElementById('network-sent').textContent = netData.totalSent < 0.01 ? '0' : parseFloat(netData.totalSent.toFixed(2));



            if (serverData.GpuUsage && serverData.GpuUsage.type === 'nvidia') {
        document.getElementById('gpu-card').style.display = 'block';
        const gpu = serverData.GpuUsage;
        const memPercentage = (gpu.gpu_mem_used / gpu.gpu_mem_total * 100).toFixed(1);
        
        charts.gpuChart = new Chart(document.getElementById('gpu-chart'), {
            type: 'bar',
            data: {
                labels: ['Core Usage', 'VRAM Usage'],
                datasets: [{
                    label: 'Percentage',
                    data: [gpu.gpu_usage, memPercentage],
                    backgroundColor: [
                        getComputedStyle(document.body).getPropertyValue('--primary-color'),
                        getComputedStyle(document.body).getPropertyValue('--secondary-color')
                    ]
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        title: { display: true, text: 'Percentage (%)' }
                    }
                }
            }
        });

        document.getElementById('gpu-usage').textContent = `${gpu.gpu_usage}%`;
        document.getElementById('gpu-mem-used').textContent = 
            (gpu.gpu_mem_used / 1024).toFixed(2);
        document.getElementById('gpu-mem-total').textContent = 
            (gpu.gpu_mem_total / 1024).toFixed(2);
    } else {
        document.getElementById('gpu-card').style.display = 'none';
        if (charts.gpuChart) charts.gpuChart.destroy();
    }


        }

        function createColumnChart(canvasId, value, label) {
            return new Chart(document.getElementById(canvasId), {
                type: 'bar',
                data: {
                    labels: [label],
                    datasets: [{
                        label: 'Usage %',
                        data: [value],
                        backgroundColor: getComputedStyle(document.body).getPropertyValue('--primary-color')
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: { 
                            beginAtZero: true,
                            max: 100,
                            title: { display: true, text: 'Percentage (%)' }
                        }
                    }
                }
            });
        }
const darkModeToggle = document.getElementById('dark-mode-toggle');

darkModeToggle.addEventListener('change', () => {
    const isDark = darkModeToggle.checked;
    updateTheme(isDark);
});

if (savedDarkMode) {
    const isDark = savedDarkMode === 'dark';
    darkModeToggle.checked = isDark;
    updateTheme(isDark);
} else {
    const isDark = default_theme === 'dark';
    darkModeToggle.checked = isDark;
    updateTheme(isDark);
}

document.addEventListener('DOMContentLoaded', async () => {
    var user = await getuserdata();
    if (user.username && user.password) {
        document.getElementById('username').value = user.username
        document.getElementById('password').value = user.password
        document.getElementById('terms-checkbox-37').checked = true; // REMEMBER ME CHECKBOX
        performLogin(user.username, user.password, true, true);
    } else {
        setTimeout(() => {
    const waitScreen = document.querySelector('.wait-screen');
    if (waitScreen) {
        waitScreen.classList.add('fade-out');
        setTimeout(() => waitScreen.style.display = 'none', 500);
    }
        }, 1500);

    }

const colorSchemeOptions = document.querySelectorAll('.theme-option');
colorSchemeOptions.forEach(option => {
    option.addEventListener('click', () => {
        colorSchemeOptions.forEach(opt => opt.classList.remove('active'));
        option.classList.add('active');
        
        const scheme = option.getAttribute('data-scheme');
        document.body.setAttribute('data-scheme', scheme);
        localStorage.setItem('colorScheme', scheme);
        
        updateChartColors();
    });
});
    
    const savedScheme = localStorage.getItem('colorScheme') || 'dark-blue';
    document.body.setAttribute('data-scheme', savedScheme);
    document.querySelectorAll('.color-scheme-selector .theme-option').forEach(opt => {
        if (opt.getAttribute('data-scheme') === savedScheme) {
            opt.classList.add('active');
        }
    });



    document.getElementById('systemname').innerHTML = `<h1 id="systemname" style="color: #e0e0e0;"><i class="fas fa-chart-line"></i> ${dashboardname}</h1>`
    document.title = dashboardname
    if(allowwatermark === false) {
        document.getElementById('watermark').style.display = 'none';
    }

});

function disableforminputs(disable) {
    document.getElementById('password').disabled = disable;
    document.getElementById('username').disabled = disable;
}



        async function performLogin(username, password, rememberMe, test) {
            if(localStorage.getItem('username_value')) {
                try {
                document.getElementById('welcomeback').textContent = `Welcome back, ${localStorage.getItem('username_value')}`
                } catch(e) {}
            }
            if(!test) {
            disableforminputs(true)
            }
            try {
                const response = await fetch(`${baseurl}/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });
                const data = await response.json();
                if (response.status === 102 && !test) {
                throw new Error('Server not responding');
                }

                if (!response.ok && !test) {
                    toast(data.error.message, 'error')
                }

                if(!response.ok && test) {
                const waitScreen = document.querySelector('.wait-screen');
                if (waitScreen) {
                    waitScreen.classList.add('fade-out');
                    setTimeout(() => waitScreen.style.display = 'none', 500);
                }
                }
                
                if (rememberMe && !test) {
                    localStorage.setItem('username', username);
                    localStorage.setItem('username_value', username);
                    localStorage.setItem('password', password);
                } else {
                    localStorage.removeItem('username');
                    localStorage.removeItem('password');
                }

                if(!test){
                sessionStorage.setItem('username', username);
                sessionStorage.setItem('password', password);
                }


                if(response.ok) {
                const data = await response
                currentServerData = data;
                loginContainer.style.display = 'none';
                dashboardContainer.style.display = 'block';
                await fetchData(true, true);
                await initWebSocket()
                return;
                //let syncedserverdata = data
                }
 

                
            } catch (error) {
                if(!test) {
                //errorMessage.textContent = error.message;
                //errorMessage.style.display = 'block';
                //setTimeout(() => errorMessage.style.display = 'none', 3000);
                }
            } finally {
                if(!test) {
            disableforminputs(false)
                }
            }
        }

        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const rememberMe = document.getElementById('terms-checkbox-37').checked;
            await performLogin(username, password, rememberMe);
        });

        // Logout
        document.getElementById('logout-btn').addEventListener('click', () => {
            localStorage.removeItem('username');
            localStorage.removeItem('password');
            dashboardContainer.style.display = 'none';
            loginContainer.style.display = 'block';
            Object.values(charts).forEach(chart => chart.destroy());
        });

document.getElementById('refresh-btn').addEventListener('click', async () => {
    fetchData(false, false, true)
});


function formatBytes(bytes) {
    if (bytes < 1024) return `${bytes.toFixed(0)}B`;
    if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(2)}KB`;
    return `${(bytes / (1024 * 1024)).toFixed(2)}MB`;
}

                let isRealtimeActive = false;
        let autoRefreshInterval = null;

        function updateCharts(serverData) {
        updateStatusText(serverData.status)
            if (charts.dbChart) {
                charts.dbChart.data.datasets[0].data = [serverData.DB_used, serverData.DB_all - serverData.DB_used];
                charts.dbChart.update();
            } else {
                charts.dbChart = new Chart(document.getElementById('db-chart'), {
                    type: 'pie',
                    data: {
                        labels: ['Used', 'Free'],
                        datasets: [{
                            data: [serverData.DB_used, serverData.DB_all - serverData.DB_used],
                            backgroundColor: [
                                getComputedStyle(document.body).getPropertyValue('--primary-color'),
                                '#ecf0f1'
                            ]
                        }]
                    },
                    options: { plugins: { tooltip: { callbacks: { label: ctx => {
                        const total = serverData.DB_all;
                        const value = ctx.raw;
                        return `${ctx.label}: ${formatStorage(value)} (${((value/total)*100).toFixed(1)}%)`;
                    }}}}}
                });
            }
            





                // NVIDIA GPU Stats
    if (serverData.GpuUsage && serverData.GpuUsage.type === 'nvidia') {
        const gpu = serverData.GpuUsage;
        const memPercentage = (gpu.gpu_mem_used / gpu.gpu_mem_total * 100).toFixed(1);
        
        if (charts.gpuChart) {
            charts.gpuChart.data.datasets[0].data = [gpu.gpu_usage, memPercentage];
            charts.gpuChart.update();
        } else {
            document.getElementById('gpu-card').style.display = 'block';
            charts.gpuChart = new Chart(document.getElementById('gpu-chart'), {
            });
        }

        document.getElementById('gpu-usage').textContent = `${gpu.gpu_usage}%`;
        document.getElementById('gpu-mem-used').textContent = 
            (gpu.gpu_mem_used / 1024).toFixed(2);
        document.getElementById('gpu-mem-total').textContent = 
            (gpu.gpu_mem_total / 1024).toFixed(2);
    } else {
        document.getElementById('gpu-card').style.display = 'none';
        if (charts.gpuChart) {
            charts.gpuChart.destroy();
            charts.gpuChart = null;
        }
    }



            // Update CPU chart
            const cpuValue = serverData.SysUsage * 100;
            document.getElementById('cpu-usage').textContent = `${cpuValue.toFixed(1)}%`;
            if (charts.cpuChart) {
                charts.cpuChart.data.datasets[0].data = [cpuValue];
                charts.cpuChart.update();
            } else {
                charts.cpuChart = createChart('cpu-chart', 'bar', ['CPU Usage'], [cpuValue], 'Usage %');
            }

            // Update RAM chart
            const ramValue = serverData.RamUsage;
            document.getElementById('ram-usage').textContent = `${ramValue.toFixed(1)}%`;
            if (charts.ramChart) {
                charts.ramChart.data.datasets[0].data = [ramValue];
                charts.ramChart.update();
            } else {
                charts.ramChart = createChart('ram-chart', 'bar', ['RAM Usage'], [ramValue], 'Usage %');
            }

            // Update Network chart
            const netData = serverData.NetworkUsage;
            const receivedKB = netData.totalReceived / 1024;
            const sentKB = netData.totalSent / 1024;
            
            const received = receivedKB * 10;
            const sent = sentKB * 10;
            
            document.getElementById('network-received').textContent = formatBytes(netData.totalReceived);
            document.getElementById('network-sent').textContent = formatBytes(netData.totalSent);
            
            if (charts.networkChart) {
                charts.networkChart.data.datasets[0].data = [received, sent];
                charts.networkChart.update();
            } else {
                charts.networkChart = new Chart(document.getElementById('network-chart'), {
                    type: 'bar',
                    data: {
                        labels: ['Received', 'Sent'],
                        datasets: [{
                            label: 'KB',
                            data: [received, sent],
                            backgroundColor: [
                                getComputedStyle(document.body).getPropertyValue('--primary-color'),
                                getComputedStyle(document.body).getPropertyValue('--secondary-color')
                            ]
                        }]
                    },
                    options: { responsive: true, scales: { y: { beginAtZero: true } } }
                });
            }
        }

        function createChart(canvasId, type, labels, data, label) {
            return new Chart(document.getElementById(canvasId), {
                type: type,
                data: {
                    labels: labels,
                    datasets: [{
                        label: label,
                        data: data,
                        backgroundColor: getComputedStyle(document.body).getPropertyValue('--primary-color')
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: { 
                            beginAtZero: true,
                            max: 100,
                            title: { display: true, text: 'Percentage (%)' }
                        }
                    },
                    animation: {
                        duration: 1000,
                        easing: 'easeOutQuart'
                    }
                }
            });
        }

        document.getElementById('realtime-toggle').addEventListener('click', toggleRealtime);
        document.getElementById('refresh-interval').addEventListener('change', updateRefreshInterval);

let socket = null;
let socketReady = false;

function initWebSocket() {
    if (socket && (socket.readyState === WebSocket.OPEN || socket.readyState === WebSocket.CONNECTING)) {
        return;
    }

    socket = new WebSocket(basews);

    socket.onopen = () => {
        socket.send(JSON.stringify({
            username: getuserdata().username,
            password: getuserdata().password
        }));
    };

    socket.onmessage = (event) => {
        const data = JSON.parse(event.data);

        if (data.report) {
            updateUIWithReport(data.report);
            socketReady = true;
        } else if (data.error) {
            console.error("WebSocket Error:", data.error);
            alert("WebSocket Error: " + data.error);
            socketReady = false;
        } else if (data.success) {
            socketReady = true;
        }
    };

    socket.onerror = (err) => {
        console.error("WebSocket error:", err);
        socketReady = false;
    };

    socket.onclose = () => {
        socketReady = false;
    };
}

function sendWSRequest(payload) {
    if (!socket || socket.readyState !== WebSocket.OPEN || !socketReady) {
        console.warn("WebSocket not ready. Reinitializing...");
        initWebSocket();

        setTimeout(() => {
            if (socket && socket.readyState === WebSocket.OPEN && socketReady) {
                socket.send(JSON.stringify(payload));
            } else {
                console.error("WebSocket still not ready after retry.");
            }
        }, 1000);
    } else {
        socket.send(JSON.stringify(payload));
    }
}


    function toggleRealtime() {
        isRealtimeActive = !isRealtimeActive;
        const toggleBtn = document.getElementById('realtime-toggle');
        toggleBtn.classList.toggle('active', isRealtimeActive);
        toggleBtn.innerHTML = `<i class="fas fa-${isRealtimeActive ? 'pause' : 'play'}"></i> Realtime`;

        if (isRealtimeActive) {
            connectWebSocket();
        } else {
            stopAutoRefresh();
            if (socket) socket.close();
        }
    }

    function connectWebSocket() {
        socket = new WebSocket(basews);

        socket.onopen = () => {

            socket.send(JSON.stringify({
                username: getuserdata().username,
                password: getuserdata().password
            }));

            startAutoRefresh();
        };

        socket.onmessage = (event) => {
            const data = JSON.parse(event.data);
            if (data.report) {
                updateUIWithReport(data.report);
            } else if (data.error) {
                console.error("WebSocket Error:", data.error);
                alert("WebSocket Error: " + data.error);
            }
        };

        socket.onerror = (err) => {
            console.error("WebSocket failed:", err);
        };

        socket.onclose = () => {
        };
    }

    function startAutoRefresh() {
        const interval = parseInt(document.getElementById('refresh-interval').value) * 1000;
        autoRefreshInterval = setInterval(() => {
            if (socket && socket.readyState === WebSocket.OPEN) {
                sendWSRequest({ request: "refresh" });
            }
        }, interval);
        //document.getElementById('refreshtimer').textContent = `${interval / 1000}s`;
    }

    function stopAutoRefresh() {
        clearInterval(autoRefreshInterval);
        autoRefreshInterval = null;
    }

    function updateUIWithReport(report) {
        updateCharts(report);
    }

        function updateRefreshInterval() {
            var input = document.getElementById('refresh-interval')
            if(input.value < 1 && laglock === true) {
                input.value = 1;
            }
            if (isRealtimeActive) {
                stopAutoRefresh();
                startAutoRefresh();
            }
        }

        async function fetchData(initcharts_anyway = false, show_waitscreen = false, show_toast = false) {
            waitscreen(show_waitscreen)
                if(show_toast == true) {
                    toast(`Refreshing data...`, 'info')
                }
            try {
                const username = await getuserdata().username
                const password = await getuserdata().password
                if (!username || !password) return;

                const response = await fetch(`${baseurl}/refresh`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });

                if (!response.ok) throw new Error('Data refresh failed');
                
                const data = await response.json();
                currentServerData = data;
                if(chartsinited == false || initcharts_anyway == true) {
                initializeCharts(data);
                } else {
                updateCharts(data);
                }
                if(show_toast == true) {
                    toast('Data refreshed', 'success')
                }
            } catch (error) {
                console.error('Refresh error:', error);
                if(show_toast == true) {
                    toast(`Refresh error:, ${error}`, 'error')
                }
            } finally {
            waitscreen(false)
        }
    }

        function updateChartColors() {
            const primary = getComputedStyle(document.body).getPropertyValue('--primary-color');
            const secondary = getComputedStyle(document.body).getPropertyValue('--secondary-color');

            if (charts.dbChart) {
                charts.dbChart.data.datasets[0].backgroundColor = [primary, '#ecf0f1'];
                charts.dbChart.update();
            }
            if (charts.networkChart) {
                charts.networkChart.data.datasets[0].backgroundColor = [primary, secondary];
                charts.networkChart.update();
            }
            if (charts.cpuChart) charts.cpuChart.data.datasets[0].backgroundColor = primary;
            if (charts.ramChart) charts.ramChart.data.datasets[0].backgroundColor = primary;
            
            [charts.cpuChart, charts.ramChart].forEach(chart => chart && chart.update());

            if (charts.gpuChart) {
        const primary = getComputedStyle(document.body).getPropertyValue('--primary-color');
        const secondary = getComputedStyle(document.body).getPropertyValue('--secondary-color');
        charts.gpuChart.data.datasets[0].backgroundColor = [primary, secondary];
        charts.gpuChart.update();
    }
        }

        document.getElementById('logout-btn').addEventListener('click', () => {
            stopAutoRefresh();
            isRealtimeActive = false;
            document.getElementById('realtime-toggle').classList.remove('active');
            document.getElementById('realtime-toggle').innerHTML = '<i class="fas fa-play"></i> Realtime';
        });


function toast(message, type = "info") {
    const toastTypes = {
        info: {
            background: "#2D9CDB",
        },
        success: {
            background: "#27AE60",
        },
        error: {
            background: "#EB5757",
        },
        warning: {
            background: "#F2C94C",
        }
    };

    const selectedType = toastTypes[type] || toastTypes.info;

    Toastify({
        text: `${message}`,
        duration: 3000,
        gravity: "bottom",
        position: "center",
        stopOnFocus: true,
        style: {
            background: selectedType.background,
            color: "#fff",
            borderRadius: "8px",
            boxShadow: "0 4px 10px rgba(0,0,0,0.2)",
            zIndex: 999999999,
            fontFamily: "sans-serif",
            fontSize: "14px",
            cursor: "default",
        },
    }).showToast();
}
    </script>
</body>
</html>